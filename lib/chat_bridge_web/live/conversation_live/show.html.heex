<.header>
  <.back navigate={~p"/conversations"} class="mb-2">Back to conversations</.back>
  <.conversation_title conversation={@conversation} user={@current_user} />
  <:actions :if={@conversation.is_group}>
    <.link patch={~p"/conversations/#{@conversation}/show/edit"} phx-click={JS.push_focus()}>
      <.button>Edit conversation</.button>
    </.link>
  </:actions>
</.header>
<div>
  <div class="mb-3">
    <div :for={message <- @messages}>
      <div class={[
        "flex",
        message.user.id == @current_user.id && "justify-end",
        message.user.id != @current_user.id && "justify-start"
      ]}>
        <b><%= message.user.nickname %></b>: <%= message.body %>
      </div>
    </div>
  </div>
  <.form :let={f} for={%{}} as={:message} phx-change="validate" phx-submit="send">
    <.input type="text" field={f[:body]} placeholder="Enter a message..." />
    <.input type="hidden" field={f[:user_id]} value={@current_user.id} />
    <.input type="hidden" field={f[:conversation_id]} value={@conversation.id} />
    <.button class="mt-2" type="submit">Send</.button>
  </.form>
</div>

<.modal
  :if={@live_action == :edit}
  id="conversation-modal"
  show
  on_cancel={JS.patch(~p"/conversations/#{@conversation}")}
>
  <.live_component
    module={ChatBridgeWeb.ConversationLive.FormComponent}
    id={@conversation.id}
    title={@page_title}
    action={@live_action}
    conversation={@conversation}
    patch={~p"/conversations/#{@conversation}"}
  />
</.modal>
